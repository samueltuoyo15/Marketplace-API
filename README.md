# Marketplace API 

## Overview
A high-performance e-commerce backend architecture built with NestJS, TypeScript, and TypeORM. This system implements a robust role-based access control (RBAC) model for buyers and sellers, utilizing PostgreSQL for persistence and JWT for stateless authentication.

## Features
- NestJS: Modular architecture for scalable enterprise applications.
- TypeORM: Advanced Data Mapper pattern for PostgreSQL database management.
- Passport & JWT: Secure authentication flow with customized strategy implementation.
- Role-Based Access Control: Specialized decorators and guards for 'buyer', 'seller', and 'admin' roles.
- Argon2: Industry-standard password hashing and security.
- Docker Integration: Pre-configured containerization for the database environment.

## Technologies Used
| Technology | Purpose |
| :--- | :--- |
| TypeScript | Type-safe development |
| NestJS | Framework architecture |
| PostgreSQL | Relational database |
| TypeORM | Object-Relational Mapping |
| Docker | Environment orchestration |
| Argon2 | Cryptographic hashing |

## Getting Started
### Installation
1. Clone the repository:
   ```bash
   git clone https://github.com/samueltuoyo15/Marketplace-API
   ```
2. Install project dependencies:
   ```bash
   npm install
   ```
3. Initialize the database container:
   ```bash
   docker-compose up -d
   ```
4. Start the application:
   ```bash
   npm run start:dev
   ```

### Environment Variables
Create a `.env` file in the root directory and populate it with the following configuration:
```env
PORT=8080
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=password
DATABASE_NAME=marketplace
JWT_SECRET_KEY=your_complex_secret_key_here
JWT_EXPIRES_IN=3600s
```

## API Documentation
### Base URL
`http://localhost:8080`

### JWT Payload Structure
```json
{
  "user_id": 10,
  "role": "buyer"
}
```

### Endpoints

#### POST /auth/register
**Request**:
```json
{
  "email": "user@example.com",
  "password": "SecurePassword123",
  "role": "buyer"
}
```
**Response**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```
**Errors**:
- 409: Account exists already

#### POST /auth/login
**Request**:
```json
{
  "email": "user@example.com",
  "password": "SecurePassword123"
}
```
**Response**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```
**Errors**:
- 404: Invalid credentials
- 401: Invalid credentials

#### POST /products
**Security**: Requires JWT and 'seller' role.
**Request**:
```json
{
  "name": "Professional Camera",
  "price": 1200.50
}
```
**Response**:
```json
{
  "id": 1,
  "name": "Professional Camera",
  "price": 1200.50,
  "sellerId": 5
}
```
**Errors**:
- 401: Unauthorized
- 403: Access denied

#### GET /products
**Request**:
`No payload required`
**Response**:
```json
[
  {
    "id": 1,
    "name": "Professional Camera",
    "price": "1200.50",
    "sellerId": 5
  }
]
```

#### POST /orders
**Security**: Requires JWT and 'buyer' role.
**Request**:
```json
{
  "productId": "1",
  "quantity": 2
}
```
**Response**:
```json
{
  "id": 1,
  "productId": "1",
  "quantity": 2,
  "buyerId": 10
}
```
**Errors**:
- 403: Access denied

#### GET /orders/me
**Security**: Requires JWT.
**Request**:
`No payload required`
**Response**:
```json
[
  {
    "id": 1,
    "productId": "1",
    "buyerId": 10,
    "quantity": 2
  }
]
```

## Contributing
- Fork the repository and create a feature branch.
- Maintain consistent coding styles as defined in `.prettierrc` and `eslint.config.mjs`.
- Ensure all tests pass by running `npm run test`.
- Submit a detailed Pull Request for review.

## Author Info
**Samuel Tuoyo**
- GitHub: [samueltuoyo15](https://github.com/samueltuoyo15)
- Twitter: [TuoyoSamuel](https://x.com/TuoyoSamuel)

![NestJS](https://img.shields.io/badge/NestJS-E0234E?style=for-the-badge&logo=nestjs&logoColor=white)
![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=for-the-badge&logo=typescript&logoColor=white)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-316192?style=for-the-badge&logo=postgresql&logoColor=white)
![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)

[![Readme was generated by Dokugen](https://img.shields.io/badge/Readme%20was%20generated%20by-Dokugen-brightgreen)](https://www.npmjs.com/package/dokugen)
